# EfiicientNets 模型

## 前言

原论文名称：**EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks**

论文下载地址：https://arxiv.org/abs/1905.11946

github上已有pytorch实现代码：https://github.com/lukemelas/efficientnet-PyTorch

**注：本文中所有图片均来自该篇论文，最后模型缩放参数来自于博文https://blog.csdn.net/qq_37541097/article/details/114434046**

## 1. 背景及优缺点

### 1.1 背景

   卷积神经网络(ConvNets)通常是在固定的资源预算下开发的，如果有更多的资源可用，就可以扩大规模获得更高的精度。通常用来扩大网络规模的方法分为三个维度：深度、宽度和图像分辨率，这些都可以提升网络的精度。在先前的很多方法中，都是单一的提升这三个中的一个。尽管可以任意缩放两个或三个维度，但任意缩放需要繁琐的手动调整，而且通常会产生次优的精度和效率（ 调参侠震怒 ）。而EfficientNet模型的优点就是使用了一种新的缩放方法，用一个简单而高效的复合系数来均匀地缩放深度/宽度/分辨率，并且得到了很理想的效果。

### 1.2 优缺点

* 优点：EfficientNets模型是一系列的模型，从EfficientNet-B0一直到EfficientNet-B7，而EfficientNet-B7在ImageNet Top-1准确率上达到了当年最高值84.3%，同时对比当年准确率最高的GPipe模型（同样达到84.3%），参数缩小了8.4倍，推理速度加快了6.1倍。


* 缺点：不少人反映EfficientNets模型在使用中特别吃显存。

![](https://img-blog.csdnimg.cn/20210416111618964.png)

图为EfficientNets模型与其他模型参数数量与准确率对比，横坐标为参数数量，纵坐标为TOP-1准确率

## 2. 方法提出及原理

### 2.1 EfficientNets模型与其他模型的区别

![](https://img-blog.csdnimg.cn/20210416111630918.png)

* (a)是基本模型。


* (b)是增加宽度，增加网络的宽度能够获得更高细粒度的特征并且也更容易训练，但对于宽度很大而深度较浅的网络往往很难学习到更深层次的特征。


* (c)是增加深度，增加网络的深度能够得到更加丰富、复杂的特征并且能够很好的应用到其它任务中。但网络的深度过深会面临梯度消失，训练困难的问题。


* (d)是增大图像分辨率，增加输入网络的图像分辨率能够潜在得获得更高细粒度的特征模板，但对于非常高的输入分辨率，准确率的增益也会减小。并且大分辨率图像会增加计算量。


* (e)是EfficientNets模型，它在三个维度都扩大了，具体扩大多少，就是通过作者提出来的复合模型扩张方法结合神经网络架构搜索（NAS）技术获得的。

### 2.2 单独放大其中一个维度

![](https://img-blog.csdnimg.cn/20210416111641738.png)

从图中可以看出，单一的放大这三个维度，模型精度都会有提升，但是准确率达到80%后基本就饱和了。为什么会饱和，部分原因是因为这三个维度是相互关联的，直观的理解就是对于大分辨率的图片，需要更深的网络来增加感受野，从而捕捉有效语义，同时也需要更宽的网络来捕捉更加精细的特征。那么同时改变这三个维度是否会有更好的结果呢。

### 2.3 同时放大多个维度

![](https://img-blog.csdnimg.cn/20210416111650792.png)

图中各色曲线上各个点是在固定深度和分辨率情况下逐渐增大宽度得到的。蓝线为深度d=1.0，分辨率r=1.0，即原始大小；红线为深度增加至原来的两倍，分辨率增加至原来的1.3倍。


   从图中可以看出，红线相对于蓝线，相同Flops下准确率提升了。因此可以发现，为了追求更好的精度和效率，在ConvNet缩放过程中，平衡网络宽度、深度和分辨率是至关重要的。但是越大规模的网络消耗的资源也是越大的，那么在固定资源预算下要怎么平衡这三个参数就成了接下来要解决的问题。

### 2.4 问题的数学表达

首先，一个卷积神经网络可以被定义为一个函数

![](https://img-blog.csdnimg.cn/20210416111659591.png)

其中Fi是运算操作，Li表示在第i层重复执行i次；<Hi,Wi,Ci>是输入第i层的特征矩阵，分别表示X的高度宽度和Channels。

要在固定资源的情况下最大化模型的准确率，就有如下优化问题：

![](https://img-blog.csdnimg.cn/20210416111706243.png)

其中d，w，r分别是模型的深度、宽度和分辨率。

在此之前也已经有少部分人尝试去平衡模型的宽度和深度，但是他们都需要非常繁琐的手动调整。而论文作者提出了一种方法，用一个复合参数Φ去统一的调整模型的三个维度，并给出如下公式：

![](https://img-blog.csdnimg.cn/20210416111715359.png)

当达到限制条件时，任意调整Φ，Flops（理论计算量）相当于增加了2^Φ倍。

为了证明复合系数调参方法的有效性，作者设计了一族称为EfficientNets的模型。为了确定α、β、γ，首先固定Φ=1，在基准网络EfficientNet-B0上利用NAS搜索得到对于EfficientNet-B0的最佳参数为α=1.2、β=1.1、γ=1.15。接着固定α=1.2、β=1.1、γ=1.15，在EfficientNet-B0的基础上使用不同的分别得到EfficientNet-B1到B7。

## 3. 模型结构以及参数

### 3.1 EfficientNet-B0模型结构

![](https://img-blog.csdnimg.cn/20210416111721404.png)

B1-B7结构均为在B0基础上改变一些参数

### 3.2 EfficientNets系列模型参数

![](https://img-blog.csdnimg.cn/20210416111729370.png)




---
![](https://img-blog.csdnimg.cn/20200727174102237.png)